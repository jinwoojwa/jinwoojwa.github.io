---
title: "[OS] Interrupt"
excerpt: "Operating Systems, Internals and Design Principles μ •λ¦¬"

categories:
  - Operating System
tags:
  - [Operating System]

permalink: /operating-system/os-interrupt/

toc: true
toc_sticky: true
use_math: true

date: 2024-06-06
last_modified_at: 2024-06-06
published: true
---

# π‘‘ Interrupt

`μΈν„°λ½νΈ (Interrupt)`λ” ν•λ“μ›¨μ–΄ λλ” μ†ν”„νΈμ›¨μ–΄ μ΄λ²¤νΈκ°€ λ°μƒν•  λ• CPUμ ν„μ¬ μ‘μ—…μ„ μ¤‘λ‹¨ν•κ³  <br>

μ¦‰μ‹ κ·Έ μ΄λ²¤νΈλ¥Ό μ²λ¦¬ν•κΈ° μ„ν• λ©”μ»¤λ‹μ¦μ΄λ‹¤. μ΄λ” μ£Όλ΅ I/O μ¥μΉλ‚ νƒ€μ΄λ¨Έ λ“±μ μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ <br>

μ‚¬μ©λλ‹¤. ν• κ°€μ§€ μλ΅, μ‹λ¶„ν•  μ‹μ¤ν…μ—μ„λ” `time slice`κ°€ λλ‚  λ• λ§λ‹¤ `Timer Interrupt`λ¥Ό <br>

λ°μƒμ‹μΌ ν„μ¬ ν”„λ΅μ„Έμ¤μ μ‘μ—…μ„ μ¤‘μ§€μ‹ν‚¤κ³ , μ¤μΌ€μ¤„λ§μ„ μ‹¤ν–‰μ‹μΌ°λ‹¤. <br>

<br>

## π’΅ μΆ…λ¥

- **ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ (Hardware Interrupt)**

    + μ™Έλ¶€ μ¥μΉ(μ: ν‚¤λ³΄λ“, λ§μ°μ¤)μ—μ„ λ°μƒν•λ©°, ν•λ“μ›¨μ–΄ μ‹ νΈλ¥Ό ν†µν•΄ CPUμ— μΈν„°λ½νΈλ¥Ό μ”μ²­ν•λ‹¤.

<br>

- **μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ(Software Interrupt) == νΈλ© (Trap)**

    + μ†ν”„νΈμ›¨μ–΄μ—μ„ λ°μƒν•λ©°, μ£Όλ΅ μμ™Έ μƒν™©(μ: 0μΌλ΅ λ‚λ„κΈ°)μ΄λ‚ μ‹μ¤ν… νΈμ¶μ„ μ„ν•΄ μ‚¬μ©λλ‹¤.

<br>

## π’΅ μ£Όμ” νΉμ„±

- **λΉ„λ™κΈ°(Asynchronous) μ΄λ²¤νΈ μ²λ¦¬**

    + μΈν„°λ½νΈλ” λΉ„λ™κΈ°μ μΌλ΅ λ°μƒν•λ‹¤.
    
    + μ¦‰, ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ ν”„λ΅κ·Έλ¨μ νλ¦„κ³Ό κ΄€κ³„μ—†μ΄ μ–Έμ λ“ μ§€ λ°μƒν•  μ μλ‹¤.

<br>

- **μ¤‘μ²© μ²λ¦¬(Nested Processing)**

    + μΈν„°λ½νΈλ” μ¤‘μ²©λμ–΄ λ°μƒν•  μ μλ‹¤.
    
    + μ¦‰, ν•λ‚μ μΈν„°λ½νΈκ°€ μ²λ¦¬λλ” λ„μ¤‘μ— λ λ‹¤λ¥Έ μΈν„°λ½νΈκ°€ λ°μƒν•  μ μλ‹¤.

    + μ΄λ¬ν• μƒν™©μ—μ„ μ‹μ¤ν…μ€ μ°μ„  μμ„μ— λ”°λΌ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ‹¤.
    
    + μλ¥Ό λ“¤μ–΄, λ†’μ€ μ°μ„  μμ„μ μΈν„°λ½νΈκ°€ λ‚®μ€ μ°μ„  μμ„μ μΈν„°λ½νΈλ³΄λ‹¤ λ¨Όμ € μ²λ¦¬λλ‹¤.

<br>

## π’΅ λ™μ‘ λ°©μ‹

<center><img src="https://github.com/jinwoojwa/jinwoo.github.io/assets/112393728/b600e11b-5ea4-49a6-b69e-bc20dbfb9575"></center>

- **μΈν„°λ½νΈ λ°μƒ**

    + μ£Όλ³€ μ¥μΉμ—μ„ μ΄λ²¤νΈκ°€ λ°μƒν•λ©΄, ν•΄λ‹Ή μ¥μΉλ” CPUμ— μΈν„°λ½νΈ μ‹ νΈλ¥Ό λ³΄λ‚Έλ‹¤.

    + `User mode`μ—μ„ `Kernel mode`λ΅ `mode change`κ°€ λ°μƒν•λ‹¤.

    <br>

        μ‚¬μ©μ λ¨λ“(User Mode) : ν”„λ΅κ·Έλ¨μ΄ μΌλ°μ μΈ μ‘μ© ν”„λ΅κ·Έλ¨ μ½”λ“λ΅ μ‹¤ν–‰λλ” λ¨λ“μ΄λ‹¤.
        μ»¤λ„ λ¨λ“(Kernel Mode) : μ΄μμ²΄μ μ ν•µμ‹¬ κΈ°λ¥μ„ μν–‰ν•κΈ° μ„ν• λ¨λ“λ΅,
                                ν•λ“μ›¨μ–΄ μμ›μ— λ€ν• μ™„μ „ν• μ ‘κ·Ό κ¶ν•μ„ κ°€μ§„λ‹¤.

<br>

- **ν„μ¬ μ‘μ—… μ¤‘λ‹¨ λ° Context μ €μ¥**

    + CPUλ” ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ λ…λ Ήμ–΄λ¥Ό μ™„λ£ν•κ³ , μΈν„°λ½νΈλ¥Ό λ°›μ•„λ“¤μΈλ‹¤.

    + ν„μ¬ μ‘μ—…μ μƒνƒ(PC, λ μ§€μ¤ν„° κ°’ λ“±)λ¥Ό μ €μ¥ν•μ—¬ λ‚μ¤‘μ— μ‘μ—…μ„ μ¬κ°ν•  μ μλ„λ΅ ν•λ‹¤.

<br>

- **μΈν„°λ½νΈ λ²΅ν„°λ¥Ό ν†µν•΄ ν•Έλ“¤λ¬ νΈμ¶**

    + CPUλ” `IVT`μ„ μ°Έμ΅°ν•μ—¬, ν•΄λ‹Ή `ISR(=μΈν„°λ½νΈ ν•Έλ“¤λ¬)`μ„ μ°Ύλ”λ‹¤.

    + `ISR(= μΈν„°λ½νΈ ν•Έλ“¤λ¬)`λ” μΈν„°λ½νΈ μ”μ²­μ„ μ²λ¦¬ν•λ” μ½”λ“λ¥Ό ν¬ν•¨ν•κ³  μλ‹¤.

    + `IDT(Interrupt Descriptor Table) = IVT (Interrupt Vector Table)`

    + `IVT` : κ° μΈν„°λ½νΈ λ²νΈμ— λ€μ‘ν•λ” `ISR(Interrupt Service Routine)` μ£Όμ†λ¥Ό κ°–λ” ν…μ΄λΈ”

<br>

- **μΈν„°λ½νΈ μ²λ¦¬**

    + `ISR`μ€ μΈν„°λ½νΈ μ„λΉ„μ¤ μ‘μ—…μ μµμ†ν•μ κΈ΄κΈ‰ν• λ¶€λ¶„μ„ μν–‰ν•λ‹¤.
    
    + μλ¥Ό λ“¤μ–΄, λ°μ΄ν„° μμ‹ μ΄λ‚ μ¥μΉ μƒνƒ ν™•μΈ λ“± μ¦‰κ°μ μΈ μ²λ¦¬κ°€ ν•„μ”ν• μ‘μ—…μ„ μν–‰ν•λ‹¤.
    
    + `ISR`μ€ λν• λ‚μ¤‘μ— μ²λ¦¬ν•  ν•„μ”κ°€ μλ” λ‚λ¨Έμ§€ μ‘μ—…(bottom half)μ„ ν‘μ‹(mark)ν•λ‹¤.
    
    + μ΄ μ‘μ—…μ€ μΈν„°λ½νΈ μ²λ¦¬μ ν•λ‹¨λ¶€λ΅, λ κΈ΄κΈ‰ν• μ‘μ—…μ„ μλ―Έν•λ‹¤.

<br>

- **μƒλ΅μ΄ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄ λ°λ³µ**

    + ISR μ‹¤ν–‰ μ¤‘μ— μƒλ΅μ΄ μΈν„°λ½νΈκ°€ λ°μƒν•λ©΄, μ»¤λ„μ€ μ„ λ‹¨κ³„λ¥Ό λ°λ³µν•μ—¬ μƒλ΅μ΄ <br>
      μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ‹¤

<br>

- **ISR μ™„λ£ ν›„ νΉλ³„ μ½”λ“ λΈ”λ΅ μ‹¤ν–‰**

    + ISR λ° λ‹¤λ¥Έ λ¨λ“  μ¤‘μ²©λ ISRμ΄ μ™„λ£λλ©΄, μ»¤λ„μ€ `Special code block`μ„ μ‹¤ν–‰ν•λ‹¤.
    
    + μ΄ μ½”λ“ λΈ”λ΅μ€ λ‹¤μ μ‘μ—…μ„ μν–‰ν•λ‹¤.

        * λ¨λ“  ν‘μ‹λ(bottom halves) μΈν„°λ½νΈ μ²λ¦¬μ ν•λ‹¨λ¶€λ¥Ό μ‹¤ν–‰ν•λ‹¤.
        * μ™„λ£λ ν”„λ΅μ„Έμ¤λ¥Ό μ¤€λΉ„ μƒνƒλ΅ μ„¤μ •ν•λ‹¤.
        * μ¤μΌ€μ¤„λ¬λ¥Ό νΈμ¶ν•λ‹¤.

<br>

- **μ¤μΌ€μ¤„λ¬κ°€ μ μ ν• μ‘μ—… μ„ νƒ**

    + μ¤μΌ€μ¤„λ¬μ— μν•΄ λ‹¤μ μ‘μ—…μ΄ μ„ νƒλλ‹¤.

        * μΈν„°λ½νΈλ μ‘μ—…μ΄ λ‹¤μ‹ μ„ νƒλ  κ²½μ° : μ €μ¥λ `context`λ¥Ό λ³µμ›ν•κ³  μΈν„°λ½νΈλ μ‘μ—…μ„ μ¬κ°
        * κ·Έ μ™Έμ κ²½μ° : `λ¬Έλ§¥ μ „ν™(Context Switch)`μ„ μν–‰ν•μ—¬ λ‹¤λ¥Έ μ‘μ—…μ„ μ‹¤ν–‰

<br>

### π© To Do After System Call/Interrupt

μ‹μ¤ν… νΈμ¶μ΄λ‚ μΈν„°λ½νΈκ°€ λ°μƒν• ν›„, μ΄μμ²΄μ λ” μ—¬λ¬ μ‘μ—…μ„ μν–‰ν•΄μ•Ό ν•λ‹¤. <br>

Linux μ΄μμ²΄μ λ” μ‹μ¤ν… νΈμ¶μ΄λ‚ μΈν„°λ½νΈκ°€ μ™„λ£λ ν›„μ— μ‹¤ν–‰λλ” `Special code block`μ„ κ°€μ§€κ³  μλ‹¤. <br>
    
μ΄ μ½”λ“ λΈ”λ΅μ€ λ‚¨μ€ μ‘μ—…μ„ μ™„λ£ν•κ³  μ‹μ¤ν… μƒνƒλ¥Ό μ κ²€ν•λ” μ—­ν• μ„ ν•λ‹¤. <br><br>

- **λ‚¨μ€ μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄ μν–‰**

    + μΈν„°λ½νΈ μ²λ¦¬μ μƒλ‹¨λ¶€μ—μ„ μ¦‰μ‹ μ²λ¦¬λμ§€ μ•μ€ μ‘μ—…(ν•λ‹¨λ¶€ μ‘μ—…)μ΄ λ‚¨μ•„ μμ„ μ μλ‹¤.
    
    + μ΄ μ‘μ—…λ“¤μ€ ν›„μ† μ²λ¦¬λ΅ μμ•½λμ–΄ μκ³ , μ΄ νΉλ³„ μ½”λ“ λΈ”λ΅μ—μ„ μν–‰λλ‹¤.

- **μ²λ¦¬ν•΄μ•Ό ν•  Signal ν™•μΈ**

    + ν”„λ΅μ„Έμ¤μ— λ€κΈ° μ¤‘μΈ `Signal`μ΄ μλ”μ§€ ν™•μΈν•κ³ , μμΌλ©΄ μ²λ¦¬ν•λ‹¤.

- **μ¤μΌ€μ¤„λ¬ νΈμ¶ ν•„μ” μ—¬λ¶€ ν™•μΈ**

- **μ¤μΌ€μ¤„λ¬ νΈμ¶ λ° ν”„λ΅μ„Έμ¤ μ „ν™**

    + μ¤μΌ€μ¤„λ¬κ°€ νΈμ¶λλ©΄, ν„μ¬ ν”„λ΅μ„Έμ¤λ¥Ό μ¤€λΉ„ μƒνƒ(Ready state)λ΅ μ „ν™ν•κ³ , <br>
      λ‹¤μ μ‹¤ν–‰ν•  ν”„λ΅μ„Έμ¤λ¥Ό μ„ νƒν•μ—¬ ν™μ„±ν™”ν•λ‹¤.

    + μ΄ κ³Όμ •μ€ `λ¬Έλ§¥ μ „ν™(Context Switch)μ„ ν¬ν•¨`ν•λ‹¤. μ¦‰, CPUλ” ν„μ¬ ν”„λ΅μ„Έμ¤μ μƒνƒλ¥Ό <br>
      μ €μ¥ν•κ³ , μ„ νƒλ μƒλ΅μ΄ ν”„λ΅μ„Έμ¤μ μƒνƒλ¥Ό λ³µμ›ν•μ—¬ μ‹¤ν–‰μ„ μ‹μ‘ν•λ‹¤.

<br>

## π’΅ μμ‹

**ν‚¤λ³΄λ“λ¥Ό μ‚¬μ©μκ°€ λλ €μ„ λ•**

1. ν‚¤λ³΄λ“λ¥Ό λ„λ¥΄λ©΄ ν‚¤λ³΄λ“ μ¥μΉλ” μΈν„°λ½νΈλ¥Ό λ°μƒμ‹μΌ CPUμ— μ•λ¦°λ‹¤.

2. CPUλ” ν„μ¬ μ‘μ—…μ„ μ¤‘λ‹¨ν•κ³ , ν‚¤λ³΄λ“ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ” ν•Έλ“¤λ¬λ¥Ό νΈμ¶ν•λ‹¤.

3. μΈν„°λ½νΈ ν•Έλ“¤λ¬λ” ν‚¤λ³΄λ“ μ…λ ¥μ„ μ½μ–΄μ™€ λ©”λ¨λ¦¬μ— μ €μ¥ν•κ±°λ‚, ν•΄λ‹Ή μ…λ ¥μ„ μ²λ¦¬ν•λ‹¤.

4. μΈν„°λ½νΈ μ²λ¦¬κ°€ μ™„λ£λλ©΄ CPUλ” μ›λμ μ‘μ—…μ„ μ¬κ°ν•λ‹¤.

<br>

**Time Slice**

μ΄μμ²΄μ λ” μ£ΌκΈ°μ μΌλ΅ `time slice`λ¥Ό μ„¤μ •ν•μ—¬ νΉμ • μ‹κ°„ κ°„κ²©λ§λ‹¤ `timer interrupt`κ°€ <br>

λ°μƒν•λ„λ΅ ν•λ‹¤. μ΄ μΈν„°λ½νΈλ” ν”„λ΅μ„Έμ¤ μ¤μΌ€μ¤„λ§κ³Ό κ°™μ€ μ£ΌκΈ°μ μΈ μ‘μ—…μ„ μν–‰ν•λ” λ° μ‚¬μ©λλ‹¤.

<br>

# π‘‘ Trap

`νΈλ© (Trap)`μ΄λ€ `CPU`μ— μν•΄ λ°μƒν•λ” `μΈν„°λ½νΈ (Interrupt)`μ΄λ‹¤. <br>

μ£Όλ΅ `λΉ„λ™κΈ° (Asynchronous)` μ†ν”„νΈμ›¨μ–΄μ μΈ μ΄λ²¤νΈλ΅ μΈν•΄ λ°μƒν•λ©°, μ»¤λ„μ€ νΈλ©μ„ <br>

μΈν„°λ½νΈμ™€ κ°™μ€ λ°©μ‹μΌλ΅ μ²λ¦¬ν•λ‹¤.
